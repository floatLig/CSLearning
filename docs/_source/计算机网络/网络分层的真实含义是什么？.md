> 计算机网络有一个显著的特点，就是这是一个不仅需要背诵，而且特别需要将原理烂熟于胸的学科。很多问题看起来懂了，但是就怕往细里问，一问就发现你懂得没有那么透彻。

**网络为什么要分层？**

因为是一个`复杂的程序都要分层`。这是架构和设计模式的问题。

【计算机科学领域的任何问题都可以通过增加一个`间接的中间层`来解决，计算机整个体系`从上到下`都是 按照严格的层次结构设计的】

分层是`层层封装`。要发送报文：应用层到运输层，需要`调用函数`来给HTTP报文加上头，运输层到网络层等同理。另一边，收到报文后：要`调用函数来识别、确认并去除MAC头的内容`，最后将HTTP报文交给监听的端口（浏览器）

### 几个问题

**问题1：TCP在建立连接时需要三次握手，在进行三次握手的时候，IP层和MAC层对应都有什么操作？**

只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。【ICMP是应用层直接使用网络层是个例外，当然，ICMP也是使用了IP（同TCP、UDP使用IP一样），只是ICMP被分在了网络层】

那TCP在三次握手的时候，IP层和MAC层在做什么呢？当然是TCP发送每一个消息，都会带着IP层和MAC层了。因为，TCP每发送一个消息，IP层和MAC层的所有机制都要运行一遍。而你只看到TCP三次握手了，其实，IP层和MAC层为此也忙活好久了。

---

**问题2：学习第三层的时候会提到，IP协议里面包含目标地址和源地址。第三层里往往还会学习路由协议。路由就像中转站，我们从原始地址A到目标地址D，中间经过两个中转站A->B->C->D，是通过路由转发的。 那么第二个问题来了。A知道自己的下一个中转站是B，那从A发出来的包，应该把B的IP地址放在哪里 呢？B知道自己的下一个中转站是C，从B发出来的包，应该把C的IP地址放在哪里呢？如果放在IP协议 中的目标地址，那包到了中转站，怎么知道最终的目的地址是D呢？**

A->B->C->D，IP的目的地址始终是D的IP地址，无论经过什么中转站，IP的目的地址都不会变。那怎么到达B、C呢？答案是MAC地址。路由器会查找路由表，找到适当的下一个网络号（IP地址），并将下一跳的MAC地址写在帧的MAC地址中，通过MAC地址，数据报就能到达下一个路由器（中转站）。

---

**问题3：你一定经常听说二层设备、三层设备。二层设备处理的通常是MAC层的东西。那我发送一个HTTP的包，是在第七层工作的，那是不是不需要经过二层设备？或者即便经过了，二层设备也不处理呢？或者换一种问法，二层设备处理的包里，有没有HTTP层的内容呢？**

所谓的二层设备、三层设备，都是这些设备上跑的程序不同而已。一个HTTP协议的包经过一个二层备，二层设备收进去的是整个网络包。这里面HTTP、TCP、 IP、 MAC都有。什么叫二层设备呀，就是`只把MAC头摘下来`，看看到底是丢弃、转发，还是自己留着。那什么叫三层设备呢？就是把MAC头摘下来之后，`再把IP头摘下来`，看看到底是丢弃、转发，还是自己留着。

---

**问题4：从你的电脑，通过SSH登录到公有云主机里面，都需要经历哪些过程？或者说你打开一个电商网站，都需要经历哪些过程？说得越详细越好。**

---

**问题5：知道IP地址，还要MAC地址干嘛？**

IP地址是网络寻址，但是要确认这个包的收件人是谁，还是要靠MAC地址，才能准确。

### 窍门

- 始终想象网络的包是层层封装的，有不同层的概念模型；
- 始终想象自己是一个处理网络包的程序：如何拿到网络包，如何根据规则进行处理，如何发出去；
- 始终牢记一个原则：只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层 没下层。
