在运输层之上，有一个应用层协议，每个应用层协议都是`为了解决某一类应用问题`，而问题的解决又必须通过位于`不同主机中的多个应用进程之间的通信和协作工作`来完成。应用层的具体内容就是精确定义`这些通信规则`。

应用层应当定义：应用进程交换的`报文类型`，如请求报文和相应报文。

互联网公共领域的标准应用的应用层协议是由RFC文档定义的，大家都可以使用，如HTTP。而互联网中还有其他应用的应用层协议不是公开的，这些协议是`专用`的，如P2P文件共享系统。

应用层的许多协议都是基于`客户服务器(client server)`方式。客户和服务器都是指通信中涉及的两个`应用进程`，只是`客户是服务请求方，而服务器是提供方`。

### 域名系统DNS

域名系统DNS（Domain Name System）是互联网使用的命名系统。主要用于：域名和IP的转换。

域名DNS被设计成一个`联机分布式数据库系统`，并采用`客户服务器`方式。DNS使`大多数名字都在本地进行解析`，仅`少量解析需要在互联网那上通信`，因此DNS系统的效率很高。【本地域名服务器存在缓存，你连接不同的网络，会有不同的本地域名服务器】

关于域名服务器：

- [host和本地域名服务器](https://blog.csdn.net/u010234516/article/details/52963954)
- [域名劫持-百度百科](https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D%E5%8A%AB%E6%8C%81/7657893?fromtitle=DNS%E5%8A%AB%E6%8C%81&fromid=6739044)
- [域名劫持和域名污染](http://www.yunweipai.com/archives/5175.html)

域名到IP地址的解析是由分布在互联网上的许多域名服务器程序（简称域名服务器）共同完成的。而人们也常把运行域名服务器程序的机器称为域名服务器。

域名到IP地址的解析过程：当某一应用进程需要把主机名解析成IP地址时，该应用进程就调用解析程序，并成为一个DNS的一个客户，把待解析的域名放在DNS请求报文中，以`UDP用户数据报`方法发给`本地域名服务器`（使用UDP是为了减少开销）。本地域名服务器在查找域名后，把对应的IP地址放在`回答报文中返回`。应用进程获得目的主机的IP地址后即可进行通信。

#### 互联网的域名结构

互联网采用层次树状结构命名。

![域名.jpg](../../_img/域名.jpg)
![域名.jpg](../../_img/域名1.jpg)
![域名.jpg](../../_img/域名2.jpg)
![域名.jpg](../../_img/域名3.jpg)
![域名.jpg](../../_img/域名4.jpg)
![域名.jpg](../../_img/域名5.jpg)

#### DNS解析过程

![DNS查询.jpg](../../_img/DNS查询.jpg)

1. 本机m.xyz.com先向其本地域名服务器dns.xyz,com进行递归查询
2. 本地域名服务器采用迭代查询。它先像`根域名服务器`查询
3. 根域名服务器告诉本地域名服务器，下一次应查询的`顶级域名服务器`dns.com的`IP地址`
4. 本地域名服务器向顶级域名服务器dns.com进行查询
5. 顶级域名服务器dns.com告诉本地域名服务器，下一次应查询的`权限域名服务器`dns.abc.com的IP地址
6. 本地域名服务器向权限域名服务器dns.abc.com进行查询
7. 权限域名服务器dns.abc.com告诉本地域名服务器，说查询的主机的IP地址
8. 本地域名服务最后把查询结果告诉主机m.xyz.com

从上看到，8个步骤需要8个UDP用户数据报报文

### SMTP、POP、IMAP

SMTP：simple mail transfer protocol简单邮件传送协议
POP: post office protocol 邮局协议
IMAP: internet message access protocol网际报文存取协议

![电子邮件主要构件.jpg](../../_img/电子邮件主要构件.jpg)

### WWW解析过程

1. 浏览器分析URL
2. 浏览器向本地DNS请求解析www.tsinghua.edu.cn的IP地址
3. 域名系统DNS解析出请求大学服务器的IP地址为166.111.4.100
4. 浏览器与服务器建立TCP连接（在服务器端IP地址是166.111.4.100，端口是80【HTTP端口】）
5. 浏览器向服务器发起请求，请求取文件命令：Get /chn/yxsz/index.htm
6. 服务器www.tsinghua.edu.cn给出响应，把文件发给浏览器
7. 释放TCP连接
8. 浏览器显示“清华大学院系设置”文件index.htm中所有文本

### NAT工作步骤

1. NAT路由器收到从专用网内部的主机发往互联网上的数据报时，NAT路由器把IP数据报的源IP地址，转化为新的源IP地址（即NAT路由器的全球IP地址），然后转发出去。
2. 当互联网上的主机给专用网的主机发送应答时，IP数据报的目的IP地址是NAT路由器的IP地址。当NAT路由器收到互联网上的主机发来的数据报时，还要进行一次IP地址的转换。通过NAT地址转换表，就可把IP数据报上的旧的IP地址转换为专用网主机真正的本地的IP地址。
3. 通过使用NAPT技术，可以使拥有多个本地地址的主机，公用一个NAT路由器上的全球IP地址